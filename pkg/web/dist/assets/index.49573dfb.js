import{f as r,R as M,bM as ne,a as le,u as ie,as as re,bO as ue,bP as ce,ar as m,e as y,F as E,j as a,k as W,P as l,ay as pe,C as me,az as de,i as p,bQ as he,d as ge}from"./index.d6bcc00a.js";import{C as Y}from"./common.module.d7e709a7.js";import{u as Ce,S as fe,c as ye,P as Ee}from"./copyToClipboard.92809abc.js";import{u as De}from"./useCraneUrl.6d6f9441.js";import{j as Re}from"./js-yaml.2f0635e4.js";import{T as be}from"./index.e834a0f0.js";import{S as ke}from"./index.af9408cc.js";import{D}from"./index.1236748a.js";import"./lodash.16bee641.js";import"./index.21bc7424.js";import"./index.7ff06c46.js";import"./DateRangePicker.9317c2ca.js";import"./Check.2eb92357.js";import"./index.c499c378.js";const we=M.lazy(()=>ne(()=>import("./Editor.d805ca09.js"),["assets/Editor.d805ca09.js","assets/index.d6bcc00a.js"])),ve=()=>{var x,F,B,T,A,$,_,K,I,L,j;const{t:o}=le(),i=ie(),[U,d]=r.exports.useState(!1),[t,u]=r.exports.useState(null),[O,R]=r.exports.useState(!1),g=re(),[q,J]=r.exports.useState([0,1]),[Q,G]=r.exports.useState(!1),[n,H]=r.exports.useState({namespace:void 0,workloadType:void 0,name:void 0}),b=De(),X=Ce(),{data:C,isFetching:Z,isError:k,isSuccess:ee,error:w}=ue({craneUrl:b,recommendationType:ce.Replicas});let h;ee?h=((x=C==null?void 0:C.data)==null?void 0:x.items)||[]:(h=[],k&&m.error(`${w.status} ${w.error}`));const v=h.filter(e=>n!=null&&n.name?new RegExp(`${n.name}.*`).test(e.name):!0).filter(e=>n!=null&&n.workloadType?(n==null?void 0:n.workloadType)===e.workloadType:!0).filter(e=>n!=null&&n.namespace?(n==null?void 0:n.namespace)===(e==null?void 0:e.namespace):!0);function te(e){J(e)}function ae(){G(!1)}const se=e=>{let s=null;try{s=Re.dump(e)}catch{}return console.log(s),s};return y(E,{children:[a(W,{children:a(l,{onClick:()=>g("/recommend/recommendationRule"),children:o("\u67E5\u770B\u63A8\u8350\u89C4\u5219")})}),a(pe,{}),a(W,{justify:"start",style:{marginBottom:"20px"},children:a(me,{children:a(fe,{recommendation:h,setFilterParams:H})})}),a(be,{loading:Z||k,data:v,verticalAlign:"middle",columns:[{title:o("\u540D\u79F0"),colKey:"metadata.name",ellipsis:!0},{title:o("\u63A8\u8350\u76EE\u6807\u540D\u79F0"),colKey:"spec.targetRef.name"},{title:o("Namespace"),ellipsis:!0,colKey:"spec.targetRef.namespace"},{title:o("\u76EE\u6807\u7C7B\u578B"),ellipsis:!0,colKey:"spec.targetRef",cell({row:e}){const{targetRef:s}=e.spec;return a(ke,{direction:"vertical",children:a(de,{theme:"success",variant:"light",children:s.kind})})}},{title:o("\u5F53\u524D\u526F\u672C\u6570"),ellipsis:!0,colKey:"status.currentInfo",cell({row:e}){var s,c;return console.log("row",e),typeof e.status.currentInfo=="string"?(c=JSON.parse((s=e==null?void 0:e.status)==null?void 0:s.currentInfo).spec)==null?void 0:c.replicas:""}},{title:o("\u526F\u672C\u6570\u63A8\u8350"),ellipsis:!0,colKey:"status.recommendedValue.replicasRecommendation.replicas"},{title:o("\u521B\u5EFA\u65F6\u95F4"),ellipsis:!0,colKey:"metadata.creationTimestamp",cell({row:e}){const s=new Date(e.metadata.creationTimestamp);return`${s.toLocaleDateString()} ${s.toLocaleTimeString()}`}},{title:o("\u66F4\u65B0\u65F6\u95F4"),ellipsis:!0,colKey:"status.lastUpdateTime",cell({row:e}){const s=new Date(e.status.lastUpdateTime);return`${s.toLocaleDateString()} ${s.toLocaleTimeString()}`}},{align:"left",fixed:"right",width:200,colKey:"op",title:o("\u64CD\u4F5C"),cell(e){return X?y(E,{children:[a(l,{theme:"primary",variant:"text",onClick:()=>{i(p.selectedWorkloadType(e.row.spec.targetRef.kind)),i(p.selectedWorkload(e.row.spec.targetRef.name)),i(p.selectedNamespace(e.row.namespace)),g("/cost/workload-insight")},children:o("\u67E5\u770B\u76D1\u63A7")}),a(l,{theme:"primary",variant:"text",onClick:()=>{i(he.endpoints.adoptRecommendation.initiate({craneUrl:b,namespace:e.row.namespace,name:e.row.name})).unwrap().then(()=>m.success(o("\u91C7\u7EB3\u63A8\u8350\u6210\u529F"))).catch(()=>m.error({content:o("\u91C7\u7EB3\u63A8\u8350\u5931\u8D25"),closeBtn:!0},1e4))},children:o("\u91C7\u7EB3\u5EFA\u8BAE")}),a(l,{theme:"primary",variant:"text",onClick:()=>{u(e.row),d(!0)},children:o("\u67E5\u770BYAML")})]}):y(E,{children:[a(l,{theme:"primary",variant:"text",onClick:()=>{i(p.selectedWorkloadType(e.row.spec.targetRef.kind)),i(p.selectedWorkload(e.row.spec.targetRef.name)),i(p.selectedNamespace(e.row.namespace)),g("/cost/workload-insight")},children:o("\u67E5\u770B\u76D1\u63A7")}),a(l,{theme:"primary",variant:"text",onClick:()=>{u(e.row),R(!0)},children:o("\u67E5\u770B\u91C7\u7EB3\u547D\u4EE4")}),a(l,{theme:"primary",variant:"text",onClick:()=>{u(e.row),d(!0)},children:o("\u67E5\u770BYAML")})]})}}],rowKey:"index",selectedRowKeys:q,hover:!0,onSelectChange:te,pagination:{defaultCurrent:1,defaultPageSize:10,total:v.length,showJumper:!0,onChange(e){console.log(e,"onChange pageInfo")},onCurrentChange(e,s){console.log(e,"onCurrentChange current"),console.log(s,"onCurrentChange pageInfo")},onPageSizeChange(e,s){console.log(e,"onPageSizeChange size"),console.log(s,"onPageSizeChange pageInfo")}}}),a(D,{header:o("\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u63A8\u8350\u89C4\u5219\uFF1F"),visible:Q,onClose:ae,children:a("p",{children:o("\u63A8\u8350\u89C4\u5219\u5C06\u4ECEAPI Server\u4E2D\u5220\u9664,\u4E14\u65E0\u6CD5\u6062\u590D")})}),a(D,{top:"5vh",width:850,visible:U,onClose:()=>{d(!1),u(null)},cancelBtn:null,onConfirm:()=>{d(!1),u(null)},children:a(M.Suspense,{fallback:"loading",children:a(we,{value:t&&(F=se(t))!=null?F:""})})}),a(D,{width:850,header:o("\u67E5\u770B\u547D\u4EE4"),visible:O,cancelBtn:a(l,{onClick:async()=>{var e,s,c,f,S,z,N,V,P;try{await ye(`patchData=\`kubectl get recommend ${(e=t==null?void 0:t.metadata)==null?void 0:e.name} -n ${(c=(s=t==null?void 0:t.spec)==null?void 0:s.targetRef)==null?void 0:c.namespace} -o jsonpath='{.status.recommendedInfo}'\`;kubectl patch ${(S=(f=t==null?void 0:t.spec)==null?void 0:f.targetRef)==null?void 0:S.kind} ${(N=(z=t==null?void 0:t.spec)==null?void 0:z.targetRef)==null?void 0:N.name} -n ${(P=(V=t==null?void 0:t.spec)==null?void 0:V.targetRef)==null?void 0:P.namespace} --patch "\${patchData}"`),await m.success("Copy command to clipboard.")}catch(oe){await m.error(`Failed to copy: ${oe}`)}},children:"Copy Code"}),confirmBtn:!1,onClose:()=>{R(!1),u(null)},children:a(Ee,{withLineNumbers:!0,language:"bash",noCopy:!0,children:`patchData=\`kubectl get recommend ${(B=t==null?void 0:t.metadata)==null?void 0:B.name} -n ${(A=(T=t==null?void 0:t.spec)==null?void 0:T.targetRef)==null?void 0:A.namespace} -o jsonpath='{.status.recommendedInfo}'\`
kubectl patch ${(_=($=t==null?void 0:t.spec)==null?void 0:$.targetRef)==null?void 0:_.kind} ${(I=(K=t==null?void 0:t.spec)==null?void 0:K.targetRef)==null?void 0:I.name} -n ${(j=(L=t==null?void 0:t.spec)==null?void 0:L.targetRef)==null?void 0:j.namespace} --patch "\${patchData}"`})})]})},xe=()=>a("div",{className:ge(Y.pageWithPadding,Y.pageWithColor),children:a(ve,{})});var Pe=r.exports.memo(xe);export{ve as SelectTable,Pe as default};
