import{f as O,s as Ie,X as Pe,_ as q,z as je,aF as xe,aG as Ne,aH as Re,bC as Be,q as _e,K as Se,R as f,j as n,aL as Ue,e as v,by as Le,d as pe,a5 as te,x as Me,$ as $e,at as X,au as Y,bS as ke,a as Z,u as J,b as E,bT as Te,bU as ze,bV as u,F as H,P as w,bW as re,Q as K,bX as fe,bY as Ve,ar as ae,bZ as Ke,l as He,b_ as We,i as qe}from"./index.3b561666.js";import{D as he}from"./index.f9439e83.js";import{F as N}from"./index.092ec01f.js";import{C as Ge}from"./Card.9a509bf5.js";import{T as Qe}from"./index.8880e189.js";import{S as Xe}from"./index.1cb69f0e.js";import{C as ne}from"./common.module.d7e709a7.js";import"./index.0420192b.js";import"./DateRangePicker.129f4a98.js";import"./Check.92a180f9.js";import"./index.87084703.js";/**
 * tdesign v1.9.3
 * (c) 2024 tdesign
 * @license MIT
 */var Ye={close:!1,maxLine:0,theme:"info"};/**
 * tdesign v1.9.3
 * (c) 2024 tdesign
 * @license MIT
 */var Ze=["message","title","operation","theme","icon","close","maxLine","onClose","className","onClosed"];function le(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),a.push.apply(a,t)}return a}function Je(e){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?le(Object(a),!0).forEach(function(t){Me(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):le(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var et=200,Ce=O.exports.forwardRef(function(e,r){var a=Ie(),t=a.classPrefix,o=Pe("alert"),d=q(o,2),p=d[0],D=d[1],h=je({CloseIcon:xe,InfoCircleFilledIcon:Ne,CheckCircleFilledIcon:Re,ErrorCircleFilledIcon:Be}),R=h.CloseIcon,y=h.InfoCircleFilledIcon,j=h.CheckCircleFilledIcon,g=h.ErrorCircleFilledIcon,i=_e(e,Ye),C=i.message,A=i.title,I=i.operation,P=i.theme,l=i.icon,c=i.close,s=i.maxLine,m=i.onClose,x=i.className,B=i.onClosed,U=B===void 0?$e:B,L=Se(i,Ze),M=f.useState(!1),_=q(M,2),$=_[0],k=_[1],T=f.useState(!1),S=q(T,2),b=S[0],F=S[1],Fe={success:j,info:y,error:g,warning:g},Oe=function(V){k(!0),m==null||m({e:V})},Ee=function(){F(!b)},we=function(){return f.isValidElement(l)?l:f.createElement(Fe[P])},De=function(){return+s>0&&Array.isArray(C)?v("div",{className:"".concat(t,"-alert__description"),children:[C.map(function(V,W){return b?n("div",{children:V},W):W<s?n("div",{children:V},W):!0}),n("div",{className:"".concat(t,"-alert__collapse"),onClick:Ee,children:D(b?p.collapseText:p.expandText)})]}):n("div",{className:"".concat(t,"-alert__description"),children:C})},Ae=function(){return n("div",{className:"".concat(t,"-alert__close"),onClick:Oe,children:typeof c=="boolean"?n(R,{}):te(c)})},ee=O.exports.useRef();return n(Ue,{in:!$,unmountOnExit:!0,classNames:{exitActive:"".concat(t,"-alert--closing")},nodeRef:ee,timeout:et,onExited:U,children:v("div",{...Je({ref:Le(r,ee),className:pe("".concat(t,"-alert"),"".concat(t,"-alert--").concat(P),x)},L),children:[n("div",{className:"".concat(t,"-alert__icon"),children:we()}),v("div",{className:"".concat(t,"-alert__content"),children:[A?n("div",{className:"".concat(t,"-alert__title"),children:A}):null,v("div",{className:"".concat(t,"-alert__message"),children:[De(),I?n("div",{className:"".concat(t,"-alert__operation"),children:te(I)}):null]})]}),c?Ae():null]})})});Ce.displayName="Alert";/**
 * tdesign v1.9.3
 * (c) 2024 tdesign
 * @license MIT
 */var G=Ce;function ie(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),a.push.apply(a,t)}return a}function se(e){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?ie(Object(a),!0).forEach(function(t){Y(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ie(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var tt={tag:"svg",attrs:{fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M14.5 4.25L8.47.77a.94.94 0 00-.94 0L1.5 4.25v6.96c0 .33.18.64.47.81L8 15.5l6.03-3.48a.94.94 0 00.47-.81V4.25zM8 7.42L3 4.54l5-2.89 5 2.89-5 2.88zm.5.87l5-2.89v5.77l-5 2.89V8.29zm-1 0v5.77l-5-2.89V5.4l5 2.89z",fillRule:"evenodd",clipRule:"evenodd"}}]},ve=O.exports.forwardRef(function(e,r){return O.exports.createElement(X,se(se({},e),{},{id:"control-platform",ref:r,icon:tt}))});ve.displayName="ControlPlatformIcon";function oe(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),a.push.apply(a,t)}return a}function ce(e){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?oe(Object(a),!0).forEach(function(t){Y(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):oe(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var rt={tag:"svg",attrs:{fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M6.23 11.89l2.12-2.12.71.7-2.12 2.13A2.5 2.5 0 013.4 9.06l2.13-2.12.7.7-2.12 2.13a1.5 1.5 0 002.12 2.12zM10.47 9.06l-.7-.7 2.12-2.13a1.5 1.5 0 10-2.12-2.12L7.65 6.23l-.71-.7L9.06 3.4a2.5 2.5 0 013.54 3.54l-2.13 2.12z",fillOpacity:.9}},{tag:"path",attrs:{fill:"currentColor",d:"M9.06 6.23L6.23 9.06l.71.7 2.83-2.82-.7-.7z",fillOpacity:.9}}]},ge=O.exports.forwardRef(function(e,r){return O.exports.createElement(X,ce(ce({},e),{},{id:"link",ref:r,icon:rt}))});ge.displayName="LinkIcon";function ue(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),a.push.apply(a,t)}return a}function de(e){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?ue(Object(a),!0).forEach(function(t){Y(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ue(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var at={tag:"svg",attrs:{fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"g",attrs:{fill:"currentColor",opacity:.9,fillOpacity:.9},children:[{tag:"path",attrs:{d:"M4.5 5h7v1h-7V5zM9 7.5H4.5v1H9v-1z"}},{tag:"path",attrs:{d:"M3 2a1 1 0 00-1 1v10a1 1 0 001 1h10a1 1 0 001-1V3a1 1 0 00-1-1H3zm10 1v10H3V3h10z"}}]}]},be=O.exports.forwardRef(function(e,r){return O.exports.createElement(X,de(de({},e),{},{id:"root-list",ref:r,icon:at}))});be.displayName="RootListIcon";function ye(e){var r,a,t="";if(typeof e=="string"||typeof e=="number")t+=e;else if(typeof e=="object")if(Array.isArray(e))for(r=0;r<e.length;r++)e[r]&&(a=ye(e[r]))&&(t&&(t+=" "),t+=a);else for(r in e)e[r]&&(t&&(t+=" "),t+=r);return t}function me(){for(var e,r,a=0,t="";a<arguments.length;)(e=arguments[a++])&&(r=ye(e))&&(t&&(t+=" "),t+=r);return t}const Q=e=>{var d,p;let r=ke("\u53D1\u751F\u672A\u77E5\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u5019\u518D\u8BD5");const a=e,t=e,o=e;return a.message?r=a.message:(d=t.data)!=null&&d.message?r=t.data.message:(p=o==null?void 0:o.data)!=null&&p.ErrStatus&&(r=e.data.ErrStatus.message),r},nt=f.memo(()=>{const{t:e}=Z(),r=J(),a=E(l=>l.editCluster.editingClusterId),t=E(l=>l.editCluster.mode),o=E(l=>l.editCluster.modalVisible),d=E(l=>l.editCluster.clusters),[p,D]=f.useState({}),h=()=>{r(u.modalVisible(!1)),r(u.resetCluster())},[R,y]=Te(),[j,g]=ze();f.useEffect(()=>()=>{r(u.resetCluster())},[r]),f.useEffect(()=>{o||r(u.resetCluster())},[r,o]),f.useEffect(()=>{y.isSuccess&&t==="create"&&(r(u.resetCluster()),r(u.modalVisible(!1)))},[y.isSuccess,r,t]),f.useEffect(()=>{g.isSuccess&&t==="update"&&(r(u.resetCluster()),r(u.modalVisible(!1)))},[r,t,g.isSuccess]);const i=l=>{var s;const c={error:!((s=d.find(m=>m.id===l))!=null&&s.clusterName),msg:e("\u96C6\u7FA4\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A")};return D(m=>({...m,[l]:{...m[l],clusterName:c}})),c},C=l=>{const c={error:!1,msg:""},s=d.find(m=>m.id===l);return s!=null&&s.craneUrl?!s.craneUrl.startsWith("http://")&&!s.craneUrl.startsWith("https://")&&(c.error=!0,c.msg=e("Crane URL\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u8BF7\u8F93\u5165\u6B63\u786E\u7684URL")):(c.error=!0,c.msg=e("Crane URL\u4E0D\u80FD\u4E3A\u7A7A")),D(m=>({...m,[l]:{...m[l],craneUrl:c}})),c.error||r(Ve.endpoints.fetchClusterListMu.initiate({craneUrl:s==null?void 0:s.craneUrl})).unwrap().then(()=>ae.success(e("\u6210\u529F\u8FDE\u63A5: {craneUrl}",{craneUrl:s==null?void 0:s.craneUrl}))).catch(()=>ae.error({content:e("\u65E0\u6CD5\u8FDE\u63A5: {craneUrl} , \u8BF7\u68C0\u67E5\u586B\u5199\u4FE1\u606F\u4EE5\u53CA\u540E\u7AEF\u670D\u52A1",{craneUrl:s==null?void 0:s.craneUrl}),closeBtn:!0},1e4)),c},A=()=>t==="create"?y.isError&&n(G,{message:Q(y.error),style:{marginBottom:0,marginTop:"1rem"},theme:"error"}):t==="update"?g.isError&&n(G,{message:Q(g.error),style:{marginBottom:0,marginTop:"1rem"},theme:"error"}):null,I=t==="create"?y.isLoading:t==="update"?g.isLoading:!1,P=()=>{let l=!1,c=null;for(const s of d){const m=i(s.id),x=C(s.id);l=l||m.error||x.error,l&&!c&&(c=s.id)}l?r(u.editingClusterId(c)):t==="create"?R({data:{clusters:(d!=null?d:[]).map(s=>({name:s.clusterName,craneUrl:s.craneUrl,discount:s.discount,preinstallRecommendation:s.preinstallRecommendation}))}}):t==="update"&&j({data:{id:d[0].id,name:d[0].clusterName,craneUrl:d[0].craneUrl,discount:d[0].discount}})};return v(he,{footer:v(H,{children:[n(w,{theme:"default",onClick:()=>{h()},children:e("\u53D6\u6D88")}),n(w,{loading:I,onClick:()=>{P()},children:e("\u786E\u5B9A")})]}),header:e(t==="create"?"\u6DFB\u52A0\u96C6\u7FA4":"\u66F4\u65B0\u96C6\u7FA4"),visible:o,width:"50%",onClose:()=>{h()},children:[n("div",{style:{marginBottom:10},children:e("\u8BF7\u8F93\u5165\u4E00\u4E2A\u53EF\u8BBF\u95EE\u7684CRANE Endpoint\uFF0C\u4EE5\u83B7\u5F97\u65B0\u96C6\u7FA4\u7684\u76F8\u5173\u6210\u672C\u6570\u636E")}),n(N,{children:n(re,{addable:t==="create",style:{border:"1px solid var(--td-component-stroke)"},theme:"card",value:a!=null?a:void 0,onAdd:()=>{t==="create"&&r(u.addCluster())},onChange:l=>{r(u.editingClusterId(l))},onRemove:l=>{r(u.deleteCluster({id:`${l.value}`}))},children:d.map((l,c)=>{var s,m,x,B,U,L,M,_,$,k,T,S;return n(re.TabPanel,{destroyOnHide:!1,label:e("\u96C6\u7FA4")+(c+1),removable:t==="create"?d.length!==1:!1,value:l.id,children:v("div",{style:{padding:"24px"},children:[n(N.FormItem,{className:me({isError:(m=(s=p[l.id])==null?void 0:s.clusterName)==null?void 0:m.error}),help:n("span",{style:{color:"var(--td-error-color)"},children:(B=(x=p[l.id])==null?void 0:x.clusterName)!=null&&B.error?(L=(U=p[l.id])==null?void 0:U.clusterName)==null?void 0:L.msg:null}),initialData:l.clusterName,label:e("\u96C6\u7FA4\u540D\u79F0"),name:`clusters[${c}].clusterName`,requiredMark:!0,children:n("div",{style:{width:"100%"},children:n(K,{placeholder:e("\u6D4B\u8BD5\u96C6\u7FA4"),prefixIcon:n(ve,{}),value:l.clusterName,onBlur:()=>{i(l.id)},onChange:b=>{r(u.updateCluster({id:l.id,data:{clusterName:b}}))}})})}),n(N.FormItem,{className:me({isError:(_=(M=p[l.id])==null?void 0:M.craneUrl)==null?void 0:_.error}),help:n("span",{style:{color:"var(--td-error-color)"},children:(k=($=p[l.id])==null?void 0:$.craneUrl)!=null&&k.error?(S=(T=p[l.id])==null?void 0:T.craneUrl)==null?void 0:S.msg:null}),initialData:l.craneUrl,label:e("CRANE URL"),name:`clusters[${c}].craneUrl`,children:n("div",{style:{width:"100%"},children:n(K,{placeholder:"http(s)://(ip/domain):port e.g. http://192.168.1.1:9090 https://gocrane.io:9090",prefixIcon:n(ge,{}),value:l.craneUrl,onBlur:()=>{C(l.id)},onChange:b=>{r(u.updateCluster({id:l.id,data:{craneUrl:b}}))}})})}),n(N.FormItem,{initialData:l.discount,label:e("\u6298\u6263"),name:`clusters[${c}].discount`,requiredMark:!0,children:n("div",{style:{width:"100%"},children:n(K,{placeholder:"100",prefixIcon:n(be,{}),type:"number",value:l.discount,onChange:b=>{let F=b;typeof F=="string"&&(F=parseInt(F,10)),r(u.updateCluster({id:l.id,data:{discount:F}}))}})})}),t==="create"?n(N.FormItem,{initialData:l.preinstallRecommendation,label:e("\u5B89\u88C5\u63A8\u8350\u89C4\u5219"),name:`clusters[${c}].preinstallRecommendation`,requiredMark:!0,children:n("div",{style:{width:"100%"},children:n(fe,{size:"large",value:l.preinstallRecommendation,onChange:b=>{let F=b;typeof F!="boolean"&&(F=!0),r(u.updateCluster({id:l.id,data:{preinstallRecommendation:F}}))}})})}):n(H,{}),n(N.FormItem,{children:n(w,{block:!0,onClick:()=>{r(u.updateCluster({id:l.id,data:{craneUrl:window.location.origin,clusterName:"Demo Cluster"}}))},children:e("\u5FEB\u901F\u586B\u5165\u9875\u9762\u5730\u5740\u4F5C\u4E3A\u96C6\u7FA4\u5730\u5740")})})]})},l.id)})})}),A()]})}),lt=f.memo(()=>{const{t:e}=Z(),r=J(),a=E(o=>o.editCluster.clusters),t=E(o=>o.overview.searchText);return v("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[n(w,{type:"button",onClick:()=>{r(u.editingClusterId(a[0].id)),r(u.modalVisible(!0)),r(u.mode("create"))},children:e("\u6DFB\u52A0\u96C6\u7FA4")}),n("div",{style:{width:"300px",display:"inline-block"},children:n(K,{placeholder:e("\u652F\u6301\u641C\u7D22\u96C6\u7FA4ID\u548C\u96C6\u7FA4\u540D\u79F0"),value:t,onChange:o=>{r(Ke.searchText(o))}})})]})}),it=O.exports.memo(()=>{var y,j,g;const{t:e}=Z(),r=J(),[a,t]=f.useState({visible:!1}),o=E(i=>i.insight.selectedClusterId),d=E(i=>i.overview.searchText),p=He({}),[D,h]=We();f.useEffect(()=>{h.isSuccess&&t({visible:!1})},[h.isSuccess]);const R=f.useMemo(()=>{var C,A,I;const i=(I=(A=(C=p.data)==null?void 0:C.data)==null?void 0:A.items)!=null?I:[];return d?i.filter(P=>P.id===d||P.name===d):i},[(j=(y=p.data)==null?void 0:y.data)==null?void 0:j.items,d]);return v("div",{children:[n(he,{cancelBtn:n(w,{theme:"default",variant:"base",onClick:()=>{t({visible:!1})},children:e("\u53D6\u6D88")}),confirmBtn:n(w,{loading:h.isLoading,onClick:()=>{a.clusterId===o&&r(qe.selectedClusterId("")),D({clusterId:a.clusterId})},children:e("\u786E\u5B9A")}),header:e("\u5220\u9664\u96C6\u7FA4"),visible:a.visible,onClose:()=>t({visible:!1}),children:v("div",{children:[e("\u786E\u8BA4\u5220\u9664\u96C6\u7FA4"),": ",(g=a.clusterName)!=null?g:"",h.isError&&n(G,{message:Q(h.error),style:{marginBottom:0,marginTop:"1rem"},theme:"error"})]})}),n(Ge,{style:{marginTop:"1rem"},children:n(Qe,{columns:[{align:"left",width:200,ellipsis:!0,colKey:"id",title:e("\u96C6\u7FA4ID")},{align:"left",width:200,ellipsis:!0,colKey:"name",title:e("\u96C6\u7FA4\u540D\u79F0")},{align:"left",width:200,ellipsis:!0,colKey:"craneUrl",title:e("CraneURL")},{align:"left",width:200,ellipsis:!0,colKey:"discount",title:e("\u6298\u6263"),cell({row:i}){const{discount:C}=i;return n("div",{children:C||100})}},{align:"left",width:200,ellipsis:!0,colKey:"preinstallRecommendation",title:e("\u9884\u5B89\u88C5RecommendationRule"),cell({row:i}){const{preinstallRecommendation:C}=i;return n(Xe,{direction:"vertical",children:n(fe,{size:"large",value:C,disabled:!0})})}},{align:"left",fixed:"right",width:180,colKey:"op",title:e("\u64CD\u4F5C"),cell({row:i}){return v(H,{children:[n(w,{theme:"primary",variant:"text",onClick:()=>{r(u.modalVisible(!0)),r(u.mode("update")),r(u.editingClusterId(i.id)),r(u.setClusters([{id:i.id,clusterName:i.name,craneUrl:i.craneUrl}]))},children:e("\u4FEE\u6539")}),n(w,{theme:"primary",variant:"text",onClick:()=>{t({visible:!0,clusterId:i.id,clusterName:i.name})},children:e("\u5220\u9664")})]})}}],data:R,empty:e("\u6682\u65E0\u6570\u636E"),rowKey:"id"})})]})});var gt=O.exports.memo(()=>n("div",{className:pe(ne.pageWithPadding,ne.pageWithColor),children:v(H,{children:[n(lt,{}),n(it,{}),n(nt,{})]})}));export{gt as default};
