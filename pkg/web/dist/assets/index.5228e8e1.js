import{f as x,R as se,bM as de,a as he,u as ge,as as fe,bO as Ce,bP as ye,ar as b,e as T,F as A,j as s,k as ee,P as v,ay as Ee,C as ve,az as M,i as k,bQ as xe,d as De}from"./index.e999ac47.js";import{C as te}from"./common.module.d7e709a7.js";import{u as ke,S as Re,c as be,P as Te}from"./copyToClipboard.ccfb93db.js";import{u as Be}from"./useCraneUrl.91338662.js";import{j as $e}from"./js-yaml.2f0635e4.js";import{T as we}from"./index.640e3feb.js";import{S as P}from"./index.d3417f06.js";import{D as _}from"./index.20438a09.js";import"./lodash.5105c18f.js";import"./index.6306e129.js";import"./index.f30be7d6.js";import"./DateRangePicker.128e9774.js";import"./Check.d127d56e.js";import"./index.c6ae74a7.js";var z=(t=>(t.m="m",t.unit="unit",t.K="k",t.M="M",t.G="G",t.T="T",t.P="P",t.E="E",t.Ki="Ki",t.Mi="Mi",t.Gi="Gi",t.Ti="Ti",t.Pi="Pi",t.Ei="Ei",t))(z||{});const Fe=["m","unit","Ki","Mi","Gi","Ti","Pi","Ei"],V=["m","unit","k","M","G","T","P","E"],Ae={Ki:"k",Mi:"M",Gi:"G",Ti:"T",Pi:"P",Ei:"E"},Me={k:"Ki",M:"Mi",G:"Gi",T:"Ti",P:"Pi",E:"Ei"};function ie(t,n,c,o,a){const m=/^(\d+(\.\d{1,5})?)([A-Za-z]+)?$/;let r,p;if(m.test(t))[r,p]=[+RegExp.$1,RegExp.$3],p===""&&(p="unit");else return"0";const d=o.indexOf("m");let f=o.indexOf(p),D=o.indexOf(a);if(n)if(D>=f)for(;f<D;)r/=f+1<=d?1e3:n,f+=1;else for(;D<f;)r*=f-1<=d?1e3:n,D+=1;let u;if(r>1)u=r.toFixed(c),u=u.replace(/0+$/,""),u=u.replace(/\.$/,"");else if(r){let B=0,R=Math.abs(r);for(;R<1;)R*=10,B+=1;u=r.toFixed(B+c-1),u=u.replace(/0+$/,""),u=u.replace(/\.$/,"")}else u=r;return String(u)}function G(t,n){return ie(t,1e3,3,V,n)}function L(t,n){return ie(t,1024,3,Fe,n)}function ae(t,n){let c=0;const o=t!=null?t:"",a=/^(\d+(\.\d{1,2})?)([A-Za-z]+)?$/;let m;a.test(o)&&(m=RegExp.$3);const r=m?V.includes(m):!1,p=V.includes(n);if(o){if(r&&p)c=+G(o,n);else if(!r&&!p)c=+L(o,n);else if(r&&!p){const d=Ae[n];d?c=+(+G(o,d)/1.024).toFixed(3):c=+G(o,n)}else if(!r&&p){const d=Me[n];d?c=+(+L(o,d)*1.024).toFixed(3):c=+L(o,n)}}else c=0;return c}const Pe=se.lazy(()=>de(()=>import("./Editor.2fa82ec9.js"),["assets/Editor.2fa82ec9.js","assets/index.e999ac47.js"])),_e=()=>{var I,K,W,Y,J,Q,S,Z,N,H,X;const{t}=he(),n=ge(),[c,o]=x.exports.useState(!1),[a,m]=x.exports.useState(null),[r,p]=x.exports.useState(!1),d=fe(),[f,D]=x.exports.useState([0,1]),[u,B]=x.exports.useState(!1),R=Be(),ne=ke(),[l,oe]=x.exports.useState({namespace:void 0,workloadType:void 0,name:void 0}),{data:F,isFetching:re,isSuccess:le,isError:j,error:O}=Ce({craneUrl:R,recommendationType:ye.Resource});let $;le?$=((I=F==null?void 0:F.data)==null?void 0:I.items)||[]:($=[],j&&b.error(`${O.status} ${O.error}`));const q=$.filter(e=>l!=null&&l.name?new RegExp(`${l.name}.*`).test(e.name):!0).filter(e=>l!=null&&l.workloadType?(l==null?void 0:l.workloadType)===e.workloadType:!0).filter(e=>l!=null&&l.namespace?(l==null?void 0:l.namespace)===(e==null?void 0:e.namespace):!0);function ue(e){D(e)}function ce(){B(!1)}const me=e=>{let i=null;try{i=$e.dump(e)}catch{}return i};return T(A,{children:[s(ee,{children:s(v,{onClick:()=>d("/recommend/recommendationRule"),children:t("\u67E5\u770B\u63A8\u8350\u89C4\u5219")})}),s(Ee,{}),s(ee,{justify:"start",style:{marginBottom:"20px"},children:s(ve,{children:s(Re,{recommendation:$,setFilterParams:oe})})}),s(we,{loading:re||j,data:q,tableLayout:"auto",verticalAlign:"middle",columns:[{title:t("\u540D\u79F0"),colKey:"metadata.name",ellipsis:!0},{title:t("\u63A8\u8350\u76EE\u6807\u540D\u79F0"),colKey:"spec.targetRef.name"},{title:t("Namespace"),ellipsis:!0,sortType:"all",colKey:"spec.targetRef.namespace"},{title:t("\u76EE\u6807\u7C7B\u578B"),ellipsis:!0,colKey:"spec.targetRef",cell({row:e}){const{targetRef:i}=e.spec;return s(P,{direction:"vertical",children:s(M,{theme:"success",variant:"light",children:i.kind})})}},{title:t("\u5F53\u524D\u8D44\u6E90(\u5BB9\u5668/CPU/Memory)"),colKey:"status.currentInfo",cell({row:e}){var i,h,C,y;if(typeof e.status.currentInfo=="string"){const g=((y=(C=(h=JSON.parse((i=e==null?void 0:e.status)==null?void 0:i.currentInfo).spec)==null?void 0:h.template)==null?void 0:C.spec)==null?void 0:y.containers)||[];if(g.length>0)return s(P,{direction:"vertical",children:g.map((E,w)=>T(M,{theme:"primary",variant:"light",children:[E.name," / ",E.resources.requests.cpu," /",ae(E.resources.requests.memory,z.Mi),"Mi"]},w))})}return""}},{title:t("\u63A8\u8350\u8D44\u6E90(\u5BB9\u5668/CPU/Memory)"),colKey:"status.recommendedInfo",cell({row:e}){var i,h,C;if(typeof e.status.recommendedValue!="string"){const y=((C=(h=(i=e==null?void 0:e.status)==null?void 0:i.recommendedValue)==null?void 0:h.resourceRequest)==null?void 0:C.containers)||[];if(y.length>0)return s(P,{direction:"vertical",children:y.map((g,E)=>T(M,{theme:"primary",variant:"light",children:[g.containerName," / ",g.target.cpu," / ",ae(g.target.memory,z.Mi),"Mi"]},E))})}return"abc"}},{title:t("\u521B\u5EFA\u65F6\u95F4"),ellipsis:!0,colKey:"metadata.creationTimestamp",cell({row:e}){const i=new Date(e.metadata.creationTimestamp);return`${i.toLocaleDateString()} ${i.toLocaleTimeString()}`}},{title:t("\u66F4\u65B0\u65F6\u95F4"),ellipsis:!0,colKey:"status.lastUpdateTime",cell({row:e}){const i=new Date(e.status.lastUpdateTime);return`${i.toLocaleDateString()} ${i.toLocaleTimeString()}`}},{align:"left",fixed:"right",width:200,colKey:"op",title:t("\u64CD\u4F5C"),cell(e){return ne?T(A,{children:[s(v,{theme:"primary",variant:"text",onClick:()=>{n(k.selectedWorkloadType(e.row.spec.targetRef.kind)),n(k.selectedWorkload(e.row.spec.targetRef.name)),n(k.selectedNamespace(e.row.namespace)),d("/cost/workload-insight")},children:t("\u67E5\u770B\u76D1\u63A7")}),s(v,{theme:"primary",variant:"text",onClick:()=>{n(xe.endpoints.adoptRecommendation.initiate({craneUrl:R,namespace:e.row.namespace,name:e.row.name})).unwrap().then(()=>b.success(t("\u91C7\u7EB3\u63A8\u8350\u6210\u529F"))).catch(()=>b.error({content:t("\u91C7\u7EB3\u63A8\u8350\u5931\u8D25"),closeBtn:!0},1e4))},children:t("\u91C7\u7EB3\u63A8\u8350")}),s(v,{theme:"primary",variant:"text",onClick:()=>{m(e.row),o(!0)},children:t("\u67E5\u770BYAML")})]}):T(A,{children:[s(v,{theme:"primary",variant:"text",onClick:()=>{n(k.selectedWorkloadType(e.row.spec.targetRef.kind)),n(k.selectedWorkload(e.row.spec.targetRef.name)),n(k.selectedNamespace(e.row.namespace)),d("/cost/workload-insight")},children:t("\u67E5\u770B\u76D1\u63A7")}),s(v,{theme:"primary",variant:"text",onClick:()=>{m(e.row),p(!0)},children:t("\u67E5\u770B\u91C7\u7EB3\u547D\u4EE4")}),s(v,{theme:"primary",variant:"text",onClick:()=>{m(e.row),o(!0)},children:t("\u67E5\u770BYAML")})]})}}],rowKey:"index",selectedRowKeys:f,hover:!0,onSelectChange:ue,pagination:{defaultCurrent:1,defaultPageSize:5,total:q.length,showJumper:!0,onChange(e){console.log(e,"onChange pageInfo")},onCurrentChange(e,i){console.log(e,"onCurrentChange current"),console.log(i,"onCurrentChange pageInfo")},onPageSizeChange(e,i){console.log(e,"onPageSizeChange size"),console.log(i,"onPageSizeChange pageInfo")}}}),s(_,{header:t("\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u63A8\u8350\u89C4\u5219\uFF1F"),visible:u,onClose:ce,children:s("p",{children:t("\u63A8\u8350\u89C4\u5219\u5C06\u4ECEAPI Server\u4E2D\u5220\u9664,\u4E14\u65E0\u6CD5\u6062\u590D")})}),s(_,{top:"5vh",width:850,visible:c,onClose:()=>{o(!1),m(null)},cancelBtn:null,onConfirm:()=>{o(!1),m(null)},children:s(se.Suspense,{fallback:"loading",children:s(Pe,{value:a&&(K=me(a))!=null?K:""})})}),s(_,{width:850,header:t("\u67E5\u770B\u547D\u4EE4"),visible:r,cancelBtn:s(v,{onClick:async()=>{var e,i,h,C,y,g,E,w,U;try{await be(`patchData=\`kubectl get recommend ${(e=a==null?void 0:a.metadata)==null?void 0:e.name} -n ${(h=(i=a==null?void 0:a.spec)==null?void 0:i.targetRef)==null?void 0:h.namespace} -o jsonpath='{.status.recommendedInfo}'\`;kubectl patch ${(y=(C=a==null?void 0:a.spec)==null?void 0:C.targetRef)==null?void 0:y.kind} ${(E=(g=a==null?void 0:a.spec)==null?void 0:g.targetRef)==null?void 0:E.name} -n ${(U=(w=a==null?void 0:a.spec)==null?void 0:w.targetRef)==null?void 0:U.namespace} --patch "\${patchData}"`),await b.success("Copy command to clipboard.")}catch(pe){await b.error(`Failed to copy: ${pe}`)}},children:"Copy Code"}),confirmBtn:!1,onClose:()=>{p(!1),m(null)},children:s(Te,{withLineNumbers:!0,language:"bash",noCopy:!0,children:`patchData=\`kubectl get recommend ${(W=a==null?void 0:a.metadata)==null?void 0:W.name} -n ${(J=(Y=a==null?void 0:a.spec)==null?void 0:Y.targetRef)==null?void 0:J.namespace} -o jsonpath='{.status.recommendedInfo}'\`
kubectl patch ${(S=(Q=a==null?void 0:a.spec)==null?void 0:Q.targetRef)==null?void 0:S.kind} ${(N=(Z=a==null?void 0:a.spec)==null?void 0:Z.targetRef)==null?void 0:N.name} -n ${(X=(H=a==null?void 0:a.spec)==null?void 0:H.targetRef)==null?void 0:X.namespace} --patch "\${patchData}"`})})]})},Ge=()=>s("div",{className:De(te.pageWithPadding,te.pageWithColor),children:s(_e,{})});var Ne=x.exports.memo(Ge);export{_e as SelectTable,Ne as default};
