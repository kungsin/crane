import{R as P,a as U,j as o,k as C,C as x,b as f,F as A,e as p,f as N,g as T,h as F}from"./index.698c2779.js";import{S as $}from"./index.ed6e5a77.js";import{C as B}from"./Card.0269d18d.js";import{u as w}from"./useCraneUrl.83474cdd.js";import{u as E,a as G,b as z}from"./useIsValidPanel.18ece626.js";import"./index.ed1c023e.js";import"./DateRangePicker.0c983cde.js";import"./index.c7534671.js";const H="_cpuChartPanel_1fqt9_1";var W={cpuChartPanel:H};const j=()=>{const{t:e}=U(),t={title:e("CPU \u8D44\u6E90\u4F7F\u7528"),subTitle:"(Core)",datePicker:!0,step:"1h",xAxis:{type:"time"},lines:[{name:"capacity",query:'SUM(kube_node_status_capacity{resource="cpu", unit="core"}  * on (node) group_left() max(kube_node_labels{label_beta_kubernetes_io_instance_type!="eklet", label_node_kubernetes_io_instance_type!~"eklet"}) by (node))'},{name:"request",query:'SUM(kube_pod_container_resource_requests{resource="cpu", unit="core"}  * on (node) group_left() max(kube_node_labels{label_beta_kubernetes_io_instance_type!="eklet", label_node_kubernetes_io_instance_type!~"eklet"}) by (node))'},{name:"limit",query:'SUM(kube_pod_container_resource_limits{resource="cpu", unit="core"}  * on (node) group_left() max(kube_node_labels{label_beta_kubernetes_io_instance_type!="eklet", label_node_kubernetes_io_instance_type!~"eklet"}) by (node))'},{name:"usage",query:'sum(label_replace(irate(container_cpu_usage_seconds_total{id="/"}[5m]), "node", "$1", "instance",  "(^[^:]+)") * on (node) group_left() max(kube_node_labels{label_beta_kubernetes_io_instance_type!~"eklet", label_node_kubernetes_io_instance_type!~"eklet"}) by (node))'}]};return o(C,{gutter:[16,16],className:W.cpuChartPanel,children:o(x,{span:12,children:o($,{title:t.title,subTitle:t.subTitle,datePicker:t.datePicker,lines:t.lines,timeRange:t.timeRange,step:t.step,xAxis:t.xAxis})})})};var I=P.memo(j);const Q="_memoryChartPanel_5sfee_1";var V={memoryChartPanel:Q};const X=()=>{const{t:e}=U(),t={title:e("Memory \u8D44\u6E90\u4F7F\u7528"),subTitle:"( GB )",datePicker:!0,step:"1h",xAxis:{type:"time"},lines:[{name:"capacity",query:'SUM(kube_node_status_capacity{resource="memory", unit="byte"}  * on (node) group_left() max(kube_node_labels{label_beta_kubernetes_io_instance_type!="eklet", label_node_kubernetes_io_instance_type!~"eklet"}) by (node)  / 1024 / 1024 / 1024 )'},{name:"request",query:'SUM(kube_pod_container_resource_requests{resource="memory", unit="byte", namespace!=""} * on (node) group_left() max(kube_node_labels{label_beta_kubernetes_io_instance_type!="eklet", label_node_kubernetes_io_instance_type!~"eklet"}) by (node)/ 1024 / 1024 / 1024)'},{name:"limits",query:'SUM(kube_pod_container_resource_limits{resource="memory", unit="byte", namespace!=""} * on (node) group_left() max(kube_node_labels{label_beta_kubernetes_io_instance_type!="eklet", label_node_kubernetes_io_instance_type!~"eklet"}) by (node) / 1024 / 1024 / 1024)'},{name:"usage",query:'SUM(label_replace(container_memory_working_set_bytes{id="/"}, "node", "$1", "instance",  "(^[^:]+)")  * on (node) group_left() max(kube_node_labels{label_beta_kubernetes_io_instance_type!="eklet", label_node_kubernetes_io_instance_type!~"eklet"}) by (node)) / 1024 / 1024 / 1024'}]};return o(C,{gutter:[16,16],className:V.memoryChartPanel,children:o(x,{span:12,children:o($,{title:t.title,subTitle:t.subTitle,datePicker:t.datePicker,lines:t.lines,timeRange:t.timeRange,step:t.step,xAxis:t.xAxis})})})};var J=P.memo(X);const R=P.memo(({panel:e,selectedDashboard:t})=>{var m,d,b;const n=f(i=>i.config.chartBaselineHeight),r=f(i=>i.config.chartDefaultHeight),u=f(i=>i.insight.selectedNamespace),s=w(),a=E({panel:e}),y=G({selectedDashboard:t}),c=z({panelId:e.id,selectedDashboard:t}),k=((m=e==null?void 0:e.gridPos)==null?void 0:m.w)>0&&((d=e==null?void 0:e.gridPos)==null?void 0:d.w)<=24?Math.floor(e.gridPos.w/2):6,g=(b=e==null?void 0:e.gridPos)!=null&&b.h?Math.max(e.gridPos.h*n,r):r,h=i=>i.title==="Cluster CPUs"||i.title==="Cluster Memory (GB)"||i.title==="Workload CPU"||i.title==="Workload Memory(GB)"||i.title==="Node Resource Cost & Utilization"||i.title==="CPU Utilization"||i.title==="CPU Requests"||i.title==="RAM Utilization"||i.title==="RAM Requests"||i.title==="Node CPU Utilization"||i.title==="Node Memory Utilization";let _=null;return(e==null?void 0:e.title)==="Cluster CPUs"?_="\u96C6\u7FA4CPU":(e==null?void 0:e.title)==="Cluster Memory (GB)"?_="\u96C6\u7FA4\u5185\u5B58":(e==null?void 0:e.title)==="Workload CPU"?_="\u96C6\u7FA4\u78C1\u76D8":(e==null?void 0:e.title)==="Workload Memory(GB)"&&(_="\u96C6\u7FA4\u7F51\u7EDC"),y&&!u||!a?null:o(A,{children:h(e)&&o(x,{span:k,children:p(B,{style:{marginBottom:"0.5rem",marginTop:"0.5rem",height:g},children:["`woshi $",e.title,"` `$",s,"/grafana/d-solo/$",t==null?void 0:t.uid,"/costs-by-dimension?$",c,"`",o("div",{children:_}),o("iframe",{frameBorder:"0",height:"100%",src:`${s}/grafana/d-solo/${t==null?void 0:t.uid}/costs-by-dimension?${c}`,width:"100%"})]})},e.id)})}),K=()=>p("div",{style:{overflowX:"hidden"},children:[o(I,{}),o(J,{})]});var oe=N.exports.memo(()=>{var y,c,k,g,h,_,m,d,b,i,M,q,S,v;const{t:e}=U(),t=w();console.log("craneUrl",t);const n=T({craneUrl:t},{skip:!t});console.log("dashboardList",n);const r=((y=n==null?void 0:n.data)!=null?y:[]).find(l=>l.uid==="cluster-overview");console.log("selectedDashboard",r);const u=F({dashboardUid:r==null?void 0:r.uid},{skip:!(r!=null&&r.uid)});console.log("dashboardDetail",u);const s=((c=n==null?void 0:n.data)!=null?c:[]).find(l=>l.uid==="workload-overview");console.log("selectedDashboard",s);const a=F({dashboardUid:s==null?void 0:s.uid},{skip:!(s!=null&&s.uid)});return console.log("dashboardDetail",a),p(A,{children:[o(K,{}),p("div",{children:[o(C,{style:{marginTop:10},children:!(s!=null&&s.uid)||((h=(g=(k=a==null?void 0:a.data)==null?void 0:k.dashboard)==null?void 0:g.panels)==null?void 0:h.length)===0?o("span",{children:e("\u6682\u65E0\u6570\u636E")}):((d=(m=(_=a==null?void 0:a.data)==null?void 0:_.dashboard)==null?void 0:m.panels)!=null?d:[]).map(l=>o(R,{panel:l,selectedDashboard:s},l.id))}),o(C,{style:{marginTop:100},children:!(r!=null&&r.uid)||((M=(i=(b=u==null?void 0:u.data)==null?void 0:b.dashboard)==null?void 0:i.panels)==null?void 0:M.length)===0?o("span",{children:e("\u6682\u65E0\u6570\u636E")}):((v=(S=(q=u==null?void 0:u.data)==null?void 0:q.dashboard)==null?void 0:S.panels)!=null?v:[]).map(l=>o(R,{panel:l,selectedDashboard:r},l.id))}),"-----------------------"]})]})});export{oe as default};
